<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>上传证据</title>
    <link href="{% static 'evidencestyle.css' %}" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>上传证据</h2>
            <button class="back-button" onclick="location.href='{% url 'Bounty:index2' %}'">返回</button>
        </div>
        <form id="upload-evidence" method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}
            <div>
                <label for="id_Text">文本描述：</label>
                <div class="input-field">{{ form.Text }}</div>
            </div>
            <div>
                <label for="id_Image">图像文件：</label>
                <div class="input-field">{{ form.Image }}</div>
            </div>
            <div>
                <label for="id_Video">视频文件：</label>
                <div class="input-field">{{ form.Video }}</div>
            </div>
            <div class="input-field">
                <button id="submit" type="submit">上传证据</button>
            </div>
            {% if form.errors %}
            <div class="error-messages">
                {% for field in form %}
                {% for error in field.errors %}
                <p>{{ error }}</p>
                {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                <p>{{ error }}</p>
                {% endfor %}
            </div>
            {% endif %}
        </form>
    </div>
    <script>
        document.getElementById('upload-evidence').addEventListener('submit', function (event) {
            event.preventDefault();
            const form = this;
            const formData = new FormData(form);
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // 处理成功的情况
                        console.log('Evidence uploaded successfully');
                        window.location.href = '/Bounty/index2/';  // 重定向到 index2 页面
                    } else {
                        // 处理失败的情况
                        console.log('Error:', data.error || data.errors);
                        alert('证据上传失败，请检查输入信息后重试');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('证据上传失败，请检查网络连接后重试');
                });
        });
    </script>
</body>
</html>